name: kind
topology:
  nodes:
    leafA:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - frrcommon/daemons:/etc/frr/daemons
        - leafA/frr.conf:/etc/frr/frr.conf
        - frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - leafA/setup.sh:/setup.sh
    leafB:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - frrcommon/daemons:/etc/frr/daemons
        - leaf1/frr.conf:/etc/frr/frr.conf
        - frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - leaf1/setup.sh:/setup.sh
    leaf2:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - frrcommon/daemons:/etc/frr/daemons
        - frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - leaf2/frr.conf:/etc/frr/frr.conf
        - leaf2/setup.sh:/setup.sh
    spine:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - frrcommon/daemons:/etc/frr/daemons
        - frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - spine/frr.conf:/etc/frr/frr.conf
        - spine/setup.sh:/setup.sh

    HOST1:
      kind: linux
      image: praqma/network-multitool:latest
      binds:
        - host1/setup.sh:/setup.sh
      cmd: sleep INF

    leaf2-switch:
      kind: bridge

    pe-kind:
      kind: k8s-kind
      startup-config: kind-configuration.yaml

    pe-kind-control-plane:
      kind: ext-container
      binds:
        - kind/setup.sh:/setup.sh

    pe-kind-worker:
      kind: ext-container
      binds:
        - kind/setupworker.sh:/setupworker.sh

  links:
    - endpoints: ["leafA:eth1", "spine:eth1"]
    - endpoints: ["leafB:eth1", "spine:eth2"]
    - endpoints: ["leafkind:eth1", "spine:eth3"]
    - endpoints: ["leafA:ethred", "hostA_red:eth1"]
    - endpoints: ["leafA:ethblue", "hostA_blue:eth1"]
    - endpoints: ["leafB:ethred", "hostB_red:eth1"]
    - endpoints: ["leafB:ethblue", "hostB_blue:eth1"]
    - endpoints: ["leafkind:toswitch", "leafkind-switch:leaf2"]
    - endpoints: ["pe-kind-control-plane:toswitch", "leafkind-switch:kindctrlpl"]
    - endpoints: ["pe-kind-worker:toswitch", "leafkind-switch:kindworker"]
